{{ define "pages/settings/timers" }}
<!doctype html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings</title>
    {{ template "template/head.includes" }}
</head>

<body class="bg-gray-50">
    {{ template "template/components/error-notification" . }}
    {{ template "templates/navbar" }}

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex gap-8">
        <!-- Secondary Navbar -->
        {{ template "pages/settings/navbar.left" }}

        <!-- Main Content Area -->
        <main id="settings-content" class="flex-1">
            <!-- 
                By default, you can show a welcome or overview.
                When a sidebar button is clicked, HTMX will replace this content.
            -->
            <div class="bg-white shadow rounded-xl py-4 px-6">
                <h1 class="text-2xl font-bold text-gray-900 mb-6">Timer settings</h1>
                <p class="text-sm text-gray-600 mb-6">
                    This page allows users to configure and manage timers for their application. Timers can be used to schedule recurring tasks, automate maintenance, or perform any time-based operations. You can enable, disable, or run timers on demand. Use the search box below to quickly find specific timers by name. Some timers are not meant to run, and are supposed to be used only for single run maintanence purposes.
                </p>
                <!-- Timer Settings Section -->
                {{ if .Timers }}
                <div class="mb-8">
                    <!-- Search and Filter Controls -->
                    <div class="mb-4 flex gap-4 items-center">
                        <div class="flex-1">
                            <input type="text" id="tableSearch" placeholder="Search timers..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto">
                        <table id="tableSizesTable" class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-1/2">
                                        Timer name
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Enabled
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Interval
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                {{ range $job := .Timers }}
                                <tr class="table-row hover:bg-gray-50" 
                                    data-table-name="{{ $job.Name | lower }}">
                                    <td class="px-6 py-4 text-sm">
                                        <div class="font-mono font-medium text-gray-900">
                                            <span class="px-1 py-1 bg-indigo-300 text-white-900 rounded">ID: {{ $job.Id }}</span>
                                            {{ $job.Name }}
                                        </div>
                                        <div class="text-xs text-gray-500 mt-1 break-words max-w-md">
                                            {{ $job.Description }}
                                        </div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        {{ if eq $job.Enabled true }}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                Enabled
                                            </span>
                                        {{ else }}
                                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                Disabled
                                            </span>
                                        {{ end }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                        {{ $job.Interval }}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <div class="flex space-x-2">
                                            <button type="button" 
                                                    class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200"
                                                    hx-post="/settings/timers/{{ $job.Id }}/run"
                                                    hx-swap="none"
                                                    hx-confirm="Are you sure you want to run this timer now?">
                                                <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                                                </svg>
                                                Start
                                            </button>
                                            {{ if eq $job.Enabled true }}
                                                <button type="button" 
                                                        class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors duration-200"
                                                        hx-post="/settings/timers/{{ $job.Id }}/disable"
                                                        hx-swap="none"
                                                        hx-confirm="Are you sure you want to disable this timer?">
                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
                                                    </svg>
                                                    Disable
                                                </button>
                                            {{ else }}
                                                <button type="button" 
                                                        class="inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200"
                                                        hx-post="/settings/timers/{{ $job.Id }}/enable"
                                                        hx-swap="none"
                                                        hx-confirm="Are you sure you want to enable this timer?">
                                                    <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                                    </svg>
                                                    Enable
                                                </button>
                                            {{ end }}
                                        </div>
                                    </td>
                                </tr>
                                {{ end }}
                            </tbody>
                        </table>
                    </div>

                    <!-- Row Count Display -->
                    <div class="mt-4 text-sm text-gray-600">
                        Showing <span id="visibleRowCount">0</span> of <span id="totalRowCount">0</span> timers
                    </div>
                </div>

                <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const searchInput = document.getElementById('tableSearch');
                    const tableRows = document.querySelectorAll('.table-row');
                    const visibleRowCountEl = document.getElementById('visibleRowCount');
                    const totalRowCountEl = document.getElementById('totalRowCount');

                    // Set total row count
                    totalRowCountEl.textContent = tableRows.length;

                    function filterTables() {
                        const searchTerm = searchInput.value.toLowerCase().trim();
                        let visibleCount = 0;

                        tableRows.forEach(row => {
                            const tableName = row.getAttribute('data-table-name');
                            
                            // Check if row should be visible based on search
                            const matchesSearch = tableName.includes(searchTerm);
                            
                            if (matchesSearch) {
                                row.style.display = '';
                                visibleCount++;
                            } else {
                                row.style.display = 'none';
                            }
                        });

                        visibleRowCountEl.textContent = visibleCount;
                    }

                    // Event listeners
                    searchInput.addEventListener('input', filterTables);

                    // Initial filter
                    filterTables();
                });
                </script>
                {{ end }}
            </div>
        </main>
    </div>
</body>

</html>
{{ end }}